{"version":3,"sources":["../src/diagramControl.js"],"names":["getColorForValue","data","value","console","info","debug","i","thresholds","length","colorMap","_","first","TimeSeries","kbn","MetricsPanelCtrl","diagramEditor","displayEditor","panelDefaults","initialZoom","colors","showLegend","maxDataPoints","mappingType","nullPointMode","format","valueName","valueMaps","op","text","content","DiagramCtrl","$scope","$injector","$sce","defaults","panel","graphId","id","log","events","on","onInitEditMode","bind","onDataReceived","mermaidAPI","initialize","startOnLoad","cloneCssStyles","logLevel","parseError","handleParseError","err","hash","svg","addEditorTab","dataList","series","map","seriesHandler","setValues","updateDiagram","seriesData","datapoints","alias","target","flotpairs","getFlotPairs","graphDefinition","render","svgCallback","svgCode","bindFunctions","updateStyle","trustAsHtml","$","key","seriesItem","targetElement","find","color","children","css","html","colorData","split","strVale","Number","trim","lastPoint","last","lastValue","isArray","valueRounded","valueFormated","isString","escape","stats","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","decimals","scaledDecimals","roundValue","tmp","isNumber","delta","dec","Math","floor","LN10","magn","pow","norm","size","result","max","templateUrl"],"mappings":"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","file":"diagramControl.js","sourcesContent":["import './libs/mermaid/dist/mermaidAPI';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\r\nimport {diagramEditor, displayEditor} from './properties';\r\nimport _ from 'lodash';\r\nimport './libs/mermaid/dist/mermaid.forest.css!'\r\nimport './diagram.css!'\r\n\r\nconst panelDefaults = {\r\n\tinitialZoom: 1,\r\n\tthresholds: '0,10',\r\n\tcolors: ['rgba(245, 54, 54, 0.9)', 'rgba(237, 129, 40, 0.89)', 'rgba(50, 172, 45, 0.97)'],\r\n\tshowLegend: true,\r\n\tmaxDataPoints: 100,\r\n\tmappingType: 1,\r\n\tnullPointMode: 'connected',\r\n\tformat: 'none',\r\n\tvalueName: 'avg',\r\n    valueMaps: [\r\n      { value: 'null', op: '=', text: 'N/A' }\r\n    ],\r\n\tcontent: 'graph LR\\n' +\r\n\t\t'A[Square Rect] -- Link text --> B((Circle))\\n' +\r\n\t\t'A --> C(Round Rect)\\n' +\r\n\t\t'B --> D{Rhombus}\\n' +\r\n\t\t'C --> D\\n'\r\n};\r\n\r\nclass DiagramCtrl extends MetricsPanelCtrl {\r\n\tconstructor($scope, $injector, $sce) {\r\n\t\tsuper($scope, $injector);\r\n\t\t_.defaults(this.panel, panelDefaults);\r\n\t\tthis.panel.graphId = 'graph_' + this.panel.id;\r\n\t\t\r\n\t\t//this.debugInfoEnabled(true);\r\n\t\tconsole.log($scope);\r\n\t\t\r\n\t\tthis.$sce = $sce;\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n\t\t\r\n\t\tmermaidAPI.initialize({\r\n\t\t    startOnLoad:false,\r\n\t\t    cloneCssStyles: false,\r\n\t\t    logLevel: 1\r\n\t\t});\r\n\t\t\r\n\t\tmermaidAPI.parseError = this.handleParseError.bind(this);\r\n\t}\r\n\t\r\n\thandleParseError(err, hash){\r\n\t\tthis.svg = '<p>Diagram Definition:</p><pre>' + err + '</pre>';\r\n\t}\r\n\t\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Diagram', diagramEditor, 2);\r\n\t\tthis.addEditorTab('Display', displayEditor, 3);\r\n\t}\r\n\t\r\n\tonDataReceived(dataList){\r\n\t\tconsole.info('received data');\r\n\t\tconsole.debug(dataList);\r\n\t\tthis.series = dataList.map(this.seriesHandler.bind(this));\r\n\t\tconsole.info('mapped dataList to series');\r\n\t\tconsole.debug(this.series);\r\n\r\n\t\tvar data = {};\r\n\t\tthis.setValues(data);\r\n\t\tthis.updateDiagram(data);\r\n\t}\r\n\r\n\tseriesHandler(seriesData) {\r\n\t\tconsole.info('creating TimeSeries');\r\n\t\tconsole.debug(seriesData);\r\n\t\tvar series = new TimeSeries({\r\n\t\t\tdatapoints: seriesData.datapoints,\r\n\t\t\talias: seriesData.target,\r\n\t\t});\r\n\r\n\t    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\r\n\t    console.info('created TimeSeries from seriesdata');\r\n\t    console.debug(series);\r\n\t    return series;\r\n\t} // End seriesHandler()\r\n\r\n\tupdateDiagram(data){\r\n\t\tif(this.panel.content.length > 0){\r\n\t\t\tvar graphDefinition = this.panel.content + '\\n';\r\n\t\t    mermaidAPI.render(this.panel.graphId, graphDefinition, function svgCallback(svgCode, bindFunctions){\r\n\t\t\t    //console.log(svgCode);\r\n\t\t\t    var svg = this.updateStyle(svgCode, data);\r\n\t\t\t    this.svg = this.$sce.trustAsHtml(svg);\r\n\t\t\t}.bind(this));\r\n\t\t}\r\n\t} // End updateDiagram()\r\n\t\r\n\tupdateStyle(svgCode, data){\r\n\t\tconsole.info('updating svg style');\r\n\t\tvar svg = $('<div>' + svgCode + '</div>');\r\n\t\tconsole.debug($(svg));\r\n\t\tconsole.debug(data);\r\n\t\tfor(var key in data){\r\n\t\t\tvar seriesItem = data[key];\r\n\t\t\tconsole.debug(seriesItem);\r\n\t\t\t//var targetElement = $(svg).find('#A').first();\r\n\t\t\tvar targetElement = $(svg).find('#'+key).first();\r\n\t\t\tconsole.info('setting node:' + key + ' to color:' + seriesItem.color);\r\n\t\t\ttargetElement.children().css('fill', seriesItem.color);\r\n\t\t}\r\n\t\tconsole.debug($(svg).html());\r\n\t\treturn $(svg).html();\r\n\t} // End updateStyle()\r\n\t\r\n\tsetValues(data) {\r\n\t\tvar colorData = {};\r\n\t\tcolorData.thresholds = this.panel.thresholds.split(',').map(function(strVale) {\r\n\t\t\treturn Number(strVale.trim());\r\n\t\t});\r\n\t\tcolorData.colorMap = this.panel.colors;\r\n\t\t\r\n\t    if (this.series && this.series.length > 0) {\r\n\t\t\tfor(var i = 0; i < this.series.length; i++){\r\n\t\t\t\tvar seriesItem = this.series[i];\r\n\t\t\t\tconsole.debug('setting values for series');\r\n\t\t\t\tconsole.debug(seriesItem);\r\n\t\t\t\tdata[seriesItem.alias] = {};\r\n\t\t\t\tvar lastPoint = _.last(seriesItem.datapoints);\r\n\t\t\t    var lastValue = _.isArray(lastPoint) ? lastPoint[0] : null;\r\n\t\t\t\r\n\t\t\t\tif (this.panel.valueName === 'name') {\r\n\t\t\t\t\tdata[seriesItem.alias].value = 0;\r\n\t\t\t        data[seriesItem.alias].valueRounded = 0;\r\n\t\t\t        data[seriesItem.alias].valueFormated = seriesItem.alias;\r\n\t\t\t\t} else if (_.isString(lastValue)) {\r\n\t\t\t        data[seriesItem.alias].value = 0;\r\n\t\t\t        data[seriesItem.alias].valueFormated = _.escape(lastValue);\r\n\t\t\t        data[seriesItem.alias].valueRounded = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata[seriesItem.alias].value = seriesItem.stats[this.panel.valueName];\r\n\t\t\t        //data[seriesItem.alias].flotpairs = seriesItem.flotpairs;\r\n\t\t\t\r\n\t\t\t        var decimalInfo = this.getDecimalsForValue(data[seriesItem.alias].value);\r\n\t\t\t        var formatFunc = kbn.valueFormats[this.panel.format];\r\n\t\t\t        data[seriesItem.alias].valueFormated = formatFunc(data[seriesItem.alias].value, decimalInfo.decimals, decimalInfo.scaledDecimals);\r\n\t\t\t        data[seriesItem.alias].valueRounded = kbn.roundValue(data[seriesItem.alias].value, decimalInfo.decimals);\r\n\t\t\t\t}\r\n\t\t\t\tdata[seriesItem.alias].color = getColorForValue(colorData, data[seriesItem.alias].value);\r\n\t\t\t}\r\n\t    }\r\n\t} // End setValues()\r\n\t\r\n\tinvertColorOrder() {\r\n\t    var tmp = this.panel.colors[0];\r\n\t    this.panel.colors[0] = this.panel.colors[2];\r\n\t    this.panel.colors[2] = tmp;\r\n\t}\r\n\r\n\tgetDecimalsForValue(value) {\r\n\t    if (_.isNumber(this.panel.decimals)) {\r\n\t      return {decimals: this.panel.decimals, scaledDecimals: null};\r\n\t    }\r\n\r\n\t    var delta = value / 2;\r\n\t    var dec = -Math.floor(Math.log(delta) / Math.LN10);\r\n\t\r\n\t    var magn = Math.pow(10, -dec),\r\n\t      norm = delta / magn, // norm is between 1.0 and 10.0\r\n\t      size;\r\n\t\r\n\t    if (norm < 1.5) {\r\n\t      size = 1;\r\n\t    } else if (norm < 3) {\r\n\t      size = 2;\r\n\t      // special case for 2.5, requires an extra decimal\r\n\t      if (norm > 2.25) {\r\n\t        size = 2.5;\r\n\t        ++dec;\r\n\t      }\r\n\t    } else if (norm < 7.5) {\r\n\t      size = 5;\r\n\t    } else {\r\n\t      size = 10;\r\n\t    }\r\n\t\r\n\t    size *= magn;\r\n\t\r\n\t    // reduce starting decimals if not needed\r\n\t    if (Math.floor(value) === value) { dec = 0; }\r\n\t\r\n\t    var result = {};\r\n\t    result.decimals = Math.max(0, dec);\r\n\t    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\r\n\t\r\n\t    return result;\r\n\t}\r\n  \r\n// End Class\r\n}\r\n\r\nfunction getColorForValue(data, value) {\r\n\tconsole.info('Getting color for value');\r\n\tconsole.debug(data);\r\n\tconsole.debug(value);\r\n\tfor (var i = data.thresholds.length; i > 0; i--) {\r\n\t\tif (value >= data.thresholds[i-1]) {\r\n\t\treturn data.colorMap[i];\r\n\t}\r\n  }\r\n  return _.first(data.colorMap);\r\n}\r\n\r\nDiagramCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n\tDiagramCtrl,\r\n\tDiagramCtrl as MetricsPanelCtrl\r\n};"]}